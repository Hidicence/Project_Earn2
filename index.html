<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專案營利管理系統</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>專案營利管理系統</h1>
            
            <!-- Google 登入狀態區域 -->
            <div class="user-status" id="userStatus">
                <div class="not-signed-in" id="notSignedIn">
                    <div class="google-login-container" id="googleLoginContainer">
                        <div class="google-signin-wrapper">
                            <h4>使用Google帳號登入</h4>
                            <div id="g_id_onload" 
                                 data-client_id="343933262520-n68g14qkgo400741vvjtk2o1dbohfnq4.apps.googleusercontent.com"
                                 data-callback="handleCredentialResponse"
                                 data-auto_prompt="false">
                            </div>
                            <div class="g_id_signin" 
                                 data-type="standard"
                                 data-shape="rectangular"
                                 data-theme="filled_blue"
                                 data-text="signin_with"
                                 data-size="large"
                                 data-logo_alignment="left">
                            </div>
                        </div>
                    </div>
                    
                    <div class="alternative-login">
                        <div class="divider">
                            <span>或</span>
                        </div>
                        <div class="local-mode-option">
                            <p>無法使用Google登入？</p>
                            <button id="useLocalOnlyBtn" class="btn tertiary">
                                <i class="fas fa-laptop"></i> 使用本地模式
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="signed-in" id="signedIn" style="display: none;">
                    <div class="user-info">
                        <img id="userPhoto" class="user-photo" src="" alt="">
                        <div class="user-details">
                            <span id="userName" class="user-name"></span>
                            <span id="userEmail" class="user-email"></span>
                        </div>
                    </div>
                    <div class="sync-status" id="syncStatus">
                        <i class="fas fa-sync-alt" id="syncIcon"></i>
                        <span id="syncText">已同步</span>
                    </div>
                    <button id="signOutBtn" class="btn btn-outline">
                        <i class="fas fa-sign-out-alt"></i>
                        登出
                    </button>
                </div>
            </div>
            
            <div class="header-buttons">
                <button id="themeToggleBtn" class="btn theme-toggle" title="切換主題">
                    <i class="fas fa-moon" id="themeIcon"></i>
                    <span id="themeText">暗色模式</span>
                </button>
                <button id="addProjectBtn" class="btn primary">
                    <i class="fas fa-plus-circle"></i>
                    新增專案
                </button>
                <button id="addExpenseTypeBtn" class="btn secondary">
                    <i class="fas fa-tags"></i>
                    新增支出類型
                </button>
                <button id="exportBtn" class="btn tertiary">
                    <i class="fas fa-download"></i>
                    匯出數據
                </button>
            </div>
        </header>

        <!-- 月份標籤 -->
        <section class="month-tabs-section fade-in-up">
            <div class="month-tabs">
                <div id="monthTabsContainer" class="month-tabs-container">
                    <!-- 動態生成月份標籤 -->
                </div>
                <button id="addMonthBtn" class="btn add-month">
                    <i class="fas fa-plus"></i>
                    新增月份
                </button>
            </div>
        </section>

        <main>
            <!-- 快速統計概覽 -->
            <section class="quick-stats-section fade-in-up">
                <h2>當月快速統計</h2>
                <div class="stats-grid">
                    <div class="stat-card revenue">
                        <div class="stat-icon">
                            <i class="fas fa-arrow-trend-up"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">總收入</div>
                            <div class="stat-value" id="quickTotalIncome">$0</div>
                        </div>
                    </div>
                    <div class="stat-card expenses">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line-down"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">總支出</div>
                            <div class="stat-value" id="quickTotalExpenses">$0</div>
                        </div>
                    </div>
                    <div class="stat-card profit">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">淨利潤</div>
                            <div class="stat-value" id="quickNetProfit">$0</div>
                        </div>
                    </div>
                    <div class="stat-card ratio">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-label">平均營利比</div>
                            <div class="stat-value" id="quickAvgRatio">0%</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 專案列表 -->
            <section class="projects-section fade-in-up">
                <div class="section-header">
                    <h2>專案收支明細</h2>
                    <div class="project-controls">
                        <div class="search-box">
                            <input type="text" id="projectSearch" placeholder="搜索專案..." class="search-input">
                            <i class="search-icon fas fa-search"></i>
                        </div>
                        <select id="profitFilter" class="filter-select">
                            <option value="all">所有專案</option>
                            <option value="profitable">有盈利</option>
                            <option value="loss">虧損</option>
                            <option value="high-ratio">高營利比(≥30%)</option>
                        </select>
                    </div>
                </div>
                <div class="table-container">
                    <table id="projectsTable" class="projects-table">
                        <thead>
                            <tr>
                                <th class="project-name-col">專案名稱</th>
                                <th class="expense-col" id="expenseCol1">器材租賃費用</th>
                                <th class="expense-col" id="expenseCol2">交通費</th>
                                <th class="expense-col" id="expenseCol3">餐費</th>
                                <th class="expense-col" id="expenseCol4">雜費</th>
                                <th class="expense-col" id="expenseCol5">人事費</th>
                                <th class="expense-col" id="expenseCol6">後製費</th>
                                <th class="total-col">支出加總 <span class="info-icon" data-tip="公式：支出加總 = 各支出項目金額相加">?</span></th>
                                <th class="income-col">案件總收入(含稅)</th>
                                <th class="profit-col">專案總盈虧 <span class="info-icon" data-tip="公式：專案總盈虧 = 案件總收入 − 支出加總">?</span></th>
                                <th class="profit-ratio-col">專案營利比 <span class="info-icon" data-tip="公式：專案營利比 = 專案總盈虧 ÷ 案件總收入 × 100%">?</span></th>
                                <th class="company-profit-col">本月營運盈虧比 <span class="info-icon" data-tip="公式：本月營運盈虧比 = (案件總收入 − 配比營運支出) ÷ 案件總收入 × 100%">?</span></th>
                                <th class="payment-col">收款</th>
                                <th class="outsourcing-col">後製外發</th>
                                <th class="action-col">操作</th>
                            </tr>
                        </thead>
                        <tbody id="projectsTableBody">
                            <!-- 動態內容 -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 當月支出統計 -->
            <section class="monthly-expenses-section fade-in-up">
                <h2>當月支出統計</h2>
                <div class="monthly-expenses">
                    <div class="expense-items">
                        <div class="expense-item">
                            <label>稅金</label>
                            <input type="number" id="tax" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>公益</label>
                            <input type="number" id="charity" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>器材購買費</label>
                            <input type="number" id="equipment" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>雜支</label>
                            <input type="number" id="miscellaneous" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>薪資</label>
                            <input type="number" id="salary" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>貸款</label>
                            <input type="number" id="loan" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>房租水電</label>
                            <input type="number" id="rent" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>BNI</label>
                            <input type="number" id="bni" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>諮詢商會</label>
                            <input type="number" id="consulting" value="0" class="monthly-input">
                        </div>
                        <div class="expense-item">
                            <label>保險</label>
                            <input type="number" id="insurance" value="0" class="monthly-input">
                        </div>
                    </div>
                    
                    <div class="monthly-summary">
                        <div class="summary-item current-loss">
                            <label>當月實際營業額</label>
                            <span id="monthlyRevenue">$0</span>
                        </div>
                        <div class="summary-item monthly-expenses">
                            <label>當月支出總額</label>
                            <span id="monthlyExpenses">$0</span>
                        </div>
                        <div class="summary-item monthly-income">
                            <label>當月收款總額</label>
                            <span id="monthlyIncome">$0</span>
                        </div>
                        <div class="summary-item adjusted-profit">
                            <label>調整後盈餘</label>
                            <span id="adjustedProfit">$0</span>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 新增專案Modal -->
    <div id="addProjectModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>新增專案</h3>
            <form id="projectForm">
                <div class="form-group">
                    <label for="projectName">專案名稱</label>
                    <input type="text" id="projectName" name="projectName" required>
                </div>
                <div class="form-group">
                    <label for="projectIncome">案件總收入(含稅)</label>
                    <input type="number" id="projectIncome" name="projectIncome" required>
                </div>
                <div class="form-group">
                    <label for="projectPayment">收款金額</label>
                    <input type="number" id="projectPayment" name="projectPayment" value="0">
                </div>
                <button type="submit" class="btn primary">新增專案</button>
            </form>
        </div>
    </div>

    <!-- 支出類型管理 Modal -->
    <div id="expenseTypesModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>支出類型管理</h3>
            <div class="expense-types-list" id="expenseTypesList">
                <!-- 動態渲染支出類型列表 -->
            </div>
            <div class="form-group" style="margin-top: 1rem;">
                <label for="newExpenseTypeInput">新增支出類型</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" id="newExpenseTypeInput" placeholder="輸入類型名稱">
                    <button id="confirmAddExpenseTypeBtn" class="btn secondary"><i class="fas fa-plus"></i> 新增</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 自定義確認對話框 Modal -->
    <div id="customConfirmModal" class="modal custom-dialog">
        <div class="modal-content dialog-content">
            <div class="dialog-header">
                <h3 id="confirmTitle">確認操作</h3>
            </div>
            <div class="dialog-body">
                <p id="confirmMessage">確定要執行此操作嗎？</p>
            </div>
            <div class="dialog-footer">
                <button id="confirmCancelBtn" class="btn btn-outline">取消</button>
                <button id="confirmOkBtn" class="btn btn-danger">確定</button>
            </div>
        </div>
    </div>

    <!-- 自定義輸入對話框 Modal -->
    <div id="customPromptModal" class="modal custom-dialog">
        <div class="modal-content dialog-content">
            <div class="dialog-header">
                <h3 id="promptTitle">輸入內容</h3>
            </div>
            <div class="dialog-body">
                <p id="promptMessage">請輸入內容：</p>
                <input type="text" id="promptInput" class="form-input" placeholder="">
            </div>
            <div class="dialog-footer">
                <button id="promptCancelBtn" class="btn btn-outline">取消</button>
                <button id="promptOkBtn" class="btn primary">確定</button>
            </div>
        </div>
    </div>

    <!-- 自定義提示對話框 Modal -->
    <div id="customAlertModal" class="modal custom-dialog">
        <div class="modal-content dialog-content">
            <div class="dialog-header">
                <h3 id="alertTitle">提示</h3>
            </div>
            <div class="dialog-body">
                <p id="alertMessage">操作完成</p>
            </div>
            <div class="dialog-footer">
                <button id="alertOkBtn" class="btn primary">確定</button>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/data.js"></script>
    <script src="js/tableUI.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/app.js"></script>
</body>
</html>